<?xml version="1.0" encoding="UTF-8"?>
<server description="defaultServer">

	<!-- Enable features -->
	<featureManager>
		<feature>cdi-2.0</feature>
		<feature>jaxb-2.2</feature>
		<feature>jpa-2.2</feature>
		<feature>jsf-2.3</feature>
		<feature>jaxrs-2.1</feature>
		<feature>ejbLite-3.2</feature>
		<feature>openidConnectClient-1.0</feature>
		<feature>transportSecurity-1.0</feature>
		<feature>appSecurity-3.0</feature>
	</featureManager>

	<!-- trust JDKâ€™s default truststore -->
	<ssl id="defaultSSLConfig"  trustDefaultCerts="true" />

	<openidConnectClient
		id="liberty-aad-oidc-javaeecafe" clientId="${client.id}"
		clientSecret="${client.secret}"
		discoveryEndpointUrl="https://login.microsoftonline.com/${tenant.id}/v2.0/.well-known/openid-configuration"
		signatureAlgorithm="RS256"
		userIdentityToCreateSubject="preferred_username"
		inboundPropagation="supported" />

	<httpEndpoint id="defaultHttpEndpoint" host="*"
		httpPort="9080" httpsPort="9443" />

	<!-- Automatically expand WAR files and EAR files -->
	<applicationManager autoExpand="true" />

	<dataSource id="JavaEECafeDB"
		jdbcDriverRef="postgresql-driver" jndiName="jdbc/JavaEECafeDB"
		transactional="true" type="javax.sql.ConnectionPoolDataSource">
		<properties databaseName="postgres" portNumber="5432"
			serverName="${postgresql.server.name}" user="${postgresql.user}"
			password="${postgresql.password}" />
	</dataSource>

	<jdbcDriver id="postgresql-driver"
		javax.sql.ConnectionPoolDataSource="org.postgresql.ds.PGConnectionPoolDataSource"
		javax.sql.XADataSource="org.postgresql.xa.PGXADataSource"
		libraryRef="postgresql-library" />

	<library id="postgresql-library">
		<fileset dir="${shared.resource.dir}"
			id="PostgreSQLFileset" includes="postgresql-42.2.4.jar" />
	</library>

	<webApplication id="javaee-cafe"
		location="${server.config.dir}/apps/javaee-cafe.war">
		<application-bnd>
			<security-role name="users">
				<special-subject type="ALL_AUTHENTICATED_USERS" />
			</security-role>
		</application-bnd>
	</webApplication>
</server>